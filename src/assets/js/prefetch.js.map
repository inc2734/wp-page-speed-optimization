{"version":3,"file":"prefetch.js","mappings":"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","sources":["webpack:///./src/src/js/prefetch.js"],"sourcesContent":["const queue = [];\nconst prefetched = [];\n\nconst enqueue = (_url) => {\n  const url = new URL(_url);\n\n  if (-1 !== queue.indexOf(url.href)) {\n    return;\n  }\n\n  if (-1 !== prefetched.indexOf(url.href)) {\n    return;\n  }\n\n  if (url.href.match('wp-admin')) {\n    return;\n  }\n\n  if (url.href.match('wp-json')) {\n    return;\n  }\n\n  if (!! url.hash) {\n    return;\n  }\n\n  if (url.pathname === location.pathname) {\n    return;\n  }\n\n  queue.push(url.href);\n};\n\nconst createLinkElement = (url) => {\n  const element = document.createElement('link');\n  element.setAttribute('rel', 'prefetch');\n  element.setAttribute('href', url);\n  return element;\n};\n\nconst prefetch = (url) => {\n  const link = createLinkElement(url);\n  document.querySelector('head').append(link);\n  prefetched.push(url);\n};\n\nconst handleInterval = () => {\n  if (1 > queue.length) {\n    return;\n  }\n\n  let count = 0;\n\n  while (WPPSO.prefetch.connections > count) {\n    prefetch(queue.pop());\n    count++;\n  }\n};\n\nconst initObserve = (links) => {\n  if ('undefined' === typeof IntersectionObserver) {\n    return;\n  }\n\n  const options = {\n    root: null,\n    rootMargin: \"0px\",\n    threshold: 0,\n  };\n\n  const callback = (entries) => entries.forEach((entry) => {\n    if (true === entry.isIntersecting) {\n      enqueue(entry.target.href);\n    }\n  });\n\n  const observer = new IntersectionObserver(callback, options);\n  links.forEach((link) => observer.observe(link));\n};\n\nconst handleHover = (event) => {\n  const link = event.currentTarget;\n  enqueue(link.href);\n  link.removeEventListener('mouseenter', handleHover);\n};\n\ndocument.addEventListener(\n  'DOMContentLoaded',\n  () => {\n    if ('undefined' === typeof WPPSO.prefetch) {\n      return;\n    }\n\n    const blacklist = ['\\/wp-admin\\/', '\\/wp-login.php'];\n\n    const selectors = WPPSO.prefetch.selector.split(',');\n    const selectorWithLink = selectors.map((selector) => `${ selector } a[href^=\"${ window.location.origin }\"]`);\n    const links = [].slice.call(document.querySelectorAll(selectorWithLink)).filter((link) => {\n      return blacklist.every((regex) => ! link.href.match(regex));\n    });\n\n    initObserve(links);\n    links.forEach((link) => link.addEventListener('mouseenter', handleHover))\n    const timerId = setInterval(handleInterval, WPPSO.prefetch.interval);\n  }\n);\n"],"names":["queue","prefetched","enqueue","_url","url","URL","indexOf","href","match","hash","pathname","location","push","createLinkElement","element","document","createElement","setAttribute","prefetch","link","querySelector","append","handleInterval","length","count","WPPSO","connections","pop","initObserve","links","IntersectionObserver","options","root","rootMargin","threshold","callback","entries","forEach","entry","isIntersecting","target","observer","observe","handleHover","event","currentTarget","removeEventListener","addEventListener","blacklist","selectors","selector","split","selectorWithLink","map","window","origin","slice","call","querySelectorAll","filter","every","regex","timerId","setInterval","interval"],"sourceRoot":""}